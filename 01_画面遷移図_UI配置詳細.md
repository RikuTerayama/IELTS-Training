# MVP 画面遷移図（UI配置詳細版）

## 共通レイアウト

全画面で共通のレイアウト構造を使用：

```
┌─────────────────────────────────────────┐
│ Header                                  │
│ [アプリ名] [Home] [Progress] [Vocab]    │
│ [ログイン状態]                          │
├─────────────────────────────────────────┤
│                                         │
│ Main Content                            │
│ （画面ごとのコンテンツ）                 │
│                                         │
├─────────────────────────────────────────┤
│ Footer                                  │
│ 今日の進捗（mini） + 次のおすすめ       │
└─────────────────────────────────────────┘
```

---

## 画面A: HOME

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ カード1: 今日のおすすめ              │ │
│ │ ─────────────────────────────────── │ │
│ │ レベル: [初級/中級/上級]            │ │
│ │ 所要時間: [5/15/30分]               │ │
│ │ [Start] ボタン                      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ カード2: 弱点タグ                   │ │
│ │ ─────────────────────────────────── │ │
│ │ TR/CC/LR/GRA のうち上位1〜2を表示   │ │
│ │ 例: "最近はCCが弱め"                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Choose level] ボタン                   │
│ [Vocab 10問] ボタン                     │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `RecommendedTaskCard` - 今日のおすすめタスク（レベル、所要時間、Startボタン）
- `WeaknessTagsCard` - 弱点タグ表示（上位1〜2）
- `QuickActionButtons` - Choose level / Vocab 10問

### 遷移
- Start → `TASK`
- Choose level → `TASK`（選択レベルで遷移）
- Vocab 10問 → `VOCAB`

---

## 画面B: TASK

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ お題（IELTS形式の質問）              │ │
│ │ ─────────────────────────────────── │ │
│ │ "Some people think that..."        │ │
│ │                                     │ │
│ │ 目標: Band [6.0-6.5]                │ │
│ │ 必須語彙: [word1] [word2] [word3]  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ PREPガイド（初級/中級のみ）          │ │
│ │ ─────────────────────────────────── │ │
│ │ P (Point): [入力枠]                 │ │
│ │ R (Reason): [入力枠]                │ │
│ │ E (Example): [入力枠]               │ │
│ │ P (Point again): [入力枠]           │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 入力エリア                            │ │
│ │ ─────────────────────────────────── │ │
│ │ 初級:                                │ │
│ │   [日本語タブ] [英語タブ]            │ │
│ │   日本語: [テキストエリア]           │ │
│ │   英語: [骨格自動挿入 + 穴埋め]      │ │
│ │                                     │ │
│ │ 中級:                                │ │
│ │   [英語PREP形式入力]                 │ │
│ │                                     │ │
│ │ 上級:                                │ │
│ │   [英語自由記述]                     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Submit] ボタン                         │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `TaskQuestion` - お題表示
- `TargetBand` - 目標Band表示
- `RequiredVocabList` - 必須語彙（3〜5語）
- `PrepGuide` - PREPガイド（初級/中級のみ）
- `ResponseInput` - レベル別入力フォーム
  - 初級: 日本語タブ + 英語タブ（骨格自動挿入）
  - 中級: 英語PREP形式
  - 上級: 英語自由記述
- `SubmitButton` - 提出ボタン

### 遷移
- Submit → `FILL_IN`（初級/中級）または `FEEDBACK`（上級）

---

## 画面C: FILL_IN（穴埋め）

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 問題1: [CC/LR/GRA]                  │ │
│ │ ─────────────────────────────────── │ │
│ │ [問題文（穴埋め箇所あり）]           │ │
│ │                                     │ │
│ │ 選択肢:                              │ │
│ │ ○ A) option1                       │ │
│ │ ○ B) option2                       │ │
│ │ ○ C) option3                       │ │
│ │ ○ D) option4                       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 問題2: [CC/LR/GRA]                  │ │
│ │ （最大3問まで）                      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Check answers] ボタン                  │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 問題タイプ（3種類のみ）
1. **CC（接続詞/指示語）**: However/Therefore/This/These 等
2. **LR（言い換え）**: important→crucial 等
3. **GRA（文結合）**: because/which/although で2文を1文に

### 主要コンポーネント
- `FillInQuestion` - 選択式問題（4択、最大3問）
- `CheckAnswersButton` - 回答確認ボタン

### 遷移
- Check answers → `FEEDBACK`

---

## 画面D: FEEDBACK

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ Overall Band: [6.0-6.5]             │ │
│ │                                     │ │
│ │ 次にBandを上げる3つの行動:           │ │
│ │ 1. [title] - [why] - [how]          │ │
│ │    [example]                        │ │
│ │ 2. [title] - [why] - [how]          │ │
│ │    [example]                        │ │
│ │ 3. [title] - [why] - [how]          │ │
│ │    [example]                        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ TR（問いに答える）: [短評1行]        │ │
│ │ CC（論理の流れ）: [短評1行]         │ │
│ │ LR（語彙の幅）: [短評1行]           │ │
│ │ GRA（文法の正確さ）: [短評1行]      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Rewrite] ボタン                        │
│ [Speak] ボタン                          │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `OverallBandRange` - 総合Band推定
- `BandUpActions` - 最大3つの行動（title, why, how, example）
- `DimensionFeedback` - TR/CC/LR/GRA 各1行の短評（長文禁止）
- `ActionButtons` - Rewrite / Speak

### 遷移
- Rewrite → `REWRITE`
- Speak → `SPEAK`

---

## 画面E: REWRITE

### UI配置（デスクトップ: 2カラム、モバイル: 上下）

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌──────────────┬─────────────────────┐ │
│ │ 原文（左）    │ 編集（右）           │ │
│ │ ──────────── │ ─────────────────── │ │
│ │ [読み取り専用]│ [編集可能]           │ │
│ │              │                     │ │
│ │ 修正対象1:    │ [編集エリア1]        │ │
│ │ [ハイライト]  │ [修正方針表示]       │ │
│ │              │                     │ │
│ │ 修正対象2:    │ [編集エリア2]        │ │
│ │ [ハイライト]  │ [修正方針表示]       │ │
│ │              │                     │ │
│ │ （その他は    │ （その他は           │ │
│ │  読み取り専用）│ 読み取り専用）        │ │
│ └──────────────┴─────────────────────┘ │
│                                         │
│ [Re-evaluate] ボタン                    │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 制約
- 修正対象は最大2箇所（段落 or 文IDで指定）
- 指定範囲のみ編集可能、他は読み取り専用
- 全文書き換え禁止

### 主要コンポーネント
- `OriginalText` - 原文表示（読み取り専用）
- `EditableSections` - 編集可能エリア（最大2箇所）
- `RewriteGuidance` - 修正方針表示
- `ReevaluateButton` - 再評価ボタン

### 遷移
- Re-evaluate → `FEEDBACK`（更新版）

---

## 画面F: SPEAK

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 2-minute summary prompt              │ │
│ │ ─────────────────────────────────── │ │
│ │ "Summarize your essay in 2 minutes" │ │
│ │ [プロンプト内容]                     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ Follow-up Q x5                      │ │
│ │ ─────────────────────────────────── │ │
│ │ Q1: [質問]                          │ │
│ │ Q2: [質問]                          │ │
│ │ Q3: [質問]                          │ │
│ │ Q4: [質問]                          │ │
│ │ Q5: [質問]                          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 必須語彙（3〜5）                     │ │
│ │ [word1] [word2] [word3]              │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ※録音ボタンは作らない（Phase2）          │
│                                         │
│ [Done] ボタン                           │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `SummaryPrompt` - 2分要約プロンプト
- `FollowUpQuestions` - Follow-up質問5問
- `RequiredVocabList` - 必須語彙（3〜5語）
- `DoneButton` - 完了ボタン

### 遷移
- Done → `HOME`

---

## 画面G: VOCAB

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 今日の10問（4択）                     │ │
│ │ ─────────────────────────────────── │ │
│ │ 問題1: [英→日 / 日→英 / 文脈 / コロ]│ │
│ │ ○ A) option1                        │ │
│ │ ○ B) option2                        │ │
│ │ ○ C) option3                        │ │
│ │ ○ D) option4                        │ │
│ │                                     │ │
│ │ 問題2〜10...                         │ │
│ │                                     │ │
│ │ 進捗: [3/10]                         │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 終了後:                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 結果: 正答率 [70%]                   │ │
│ │ 間違えた語彙: [word1] [word2]        │ │
│ │                                     │ │
│ │ 「今日の必須語彙」に反映              │ │
│ │ （TaskとSpeakで表示）                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Back to Home] ボタン                   │
│ [Start Task] ボタン                     │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `QuizQuestions` - 選択式問題10問（4択）
- `ProgressBar` - 進捗バー（10問中X問）
- `ResultDisplay` - 結果表示（正答率、間違えた語彙）
- `ActionButtons` - Back to Home / Start Task

### 遷移
- Back to Home → `HOME`
- Start Task → `TASK`

---

## 画面H: PROGRESS

### UI配置

```
┌─────────────────────────────────────────┐
│ Header: [IELTS Writing] [Home] [Progress] [Vocab] [Login] │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ Attempts一覧（最新10件）              │ │
│ │ ─────────────────────────────────── │ │
│ │ 2024/01/15 初級 Band 5.5-6.0        │ │
│ │ 2024/01/14 中級 Band 6.0-6.5         │ │
│ │ 2024/01/13 初級 Band 5.0-5.5         │ │
│ │ ...                                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 平均band: [6.0-6.5]                  │ │
│ │ 弱点タグ推移: "最近はCCが弱め"        │ │
│ │ （テキストで可、グラフは不要）        │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│ Footer: 今日の進捗（mini） + 次のおすすめ │
└─────────────────────────────────────────┘
```

### 主要コンポーネント
- `AttemptsList` - タスク履歴（最新10件）
- `AverageBand` - 平均Band（rangeで可）
- `WeaknessTrend` - 弱点タグ推移（テキストのみ、グラフ不要）

### 遷移
- 各Attemptクリック → `FEEDBACK`（過去のフィードバック表示）

---

## 認証画面: AUTH

### UI配置

```
┌─────────────────────────────────────────┐
│                                         │
│         [IELTS Writing]                 │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ ログイン / サインアップ              │ │
│ │ ─────────────────────────────────── │ │
│ │ メール: [入力]                       │ │
│ │ パスワード: [入力]                   │ │
│ │                                     │ │
│ │ サインアップ時:                      │ │
│ │ 初期レベル: [初級/中級/上級]         │ │
│ │                                     │ │
│ │ [Login] / [Sign Up] ボタン           │ │
│ └─────────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
```

### 遷移
- 認証成功 → `HOME`
- 未認証ユーザーは全画面で `AUTH` にリダイレクト

---

## データフロー概要

### 縦スライス1: Login → Home → Task → Submit → Feedback → Progress
1. `AUTH` → ログイン
2. `HOME` → 推奨タスク選択
3. `TASK` → 回答入力・提出
4. `FILL_IN`（初級/中級のみ）→ 穴埋め
5. `FEEDBACK` → フィードバック表示
6. `PROGRESS` → 履歴保存・確認

### 縦スライス2: Fill-in → Feedback反映
- `FILL_IN` の回答結果を `FEEDBACK` の `band_up_actions` に反映（actionsが変わる）

### 縦スライス3: Rewrite → Re-evaluate → Feedback更新
1. `FEEDBACK` → Rewrite開始
2. `REWRITE` → 指定範囲のみ編集
3. Re-evaluate → `FEEDBACK`（更新版）

### 縦スライス4: Vocab → 今日の必須語彙連動
1. `VOCAB` → 10問完了
2. 「今日の必須語彙」に反映
3. `TASK` / `SPEAK` で必須語彙を表示

---

## 技術的な遷移制約

- 未認証ユーザー: `AUTH` 以外の全画面でリダイレクト
- タスク未選択: `TASK` 以外の学習画面（`FILL_IN`, `FEEDBACK`, `REWRITE`, `SPEAK`）はアクセス不可
- レベル別制御: 初級/中級は `FILL_IN` 必須、上級はスキップ可能
- 書き直し制限: `REWRITE` は `FEEDBACK` からしか遷移不可、最大3回まで
- 修正対象: `REWRITE` は最大2箇所のみ編集可能

